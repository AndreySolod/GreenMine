{% extends 'layout/base.html' %}

{% block page_content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div id="pentest-chain-scheme" class="full-screen-element"></div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block script %}
{{ super() }}
<script nonce="{{ csp_nonce() }}" type="text/javascript">
    var nodes = new vis.DataSet(JSON.parse("{{ nodes|escapejs }}"));
    var edges = new vis.DataSet(JSON.parse("{{ edges|escapejs }}"));
    var container = document.getElementById('pentest-chain-scheme');
    var data = {
        nodes: nodes,
        edges: edges,
    };
    var options = {autoResize: true,
        height: '100%',
        width: '100%',
        locale: '{{ g.locale }}'};
    var network = new vis.Network(container, data, options);
    network.on('doubleClick', function(properties) {
        if(properties.nodes.length == 1) {
            let node_id = properties.nodes[0];
            window.location.href = "{{ url_for('pentest_events.researcher_event_show', event_id='__event_id') }}".replace('__event_id', node_id);
        };
    });
</script>
{% endblock %}