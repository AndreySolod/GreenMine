{% extends 'layout/base.html' %}
{% from 'layout/_macrosses.html' import bootstrap_table_icons %}


{% block page_content %}
<div class="row gutters">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                    <table class="table"    id="issues-table"
                                            data-search="true"
                                            data-show-columns="true"
                                            data-show-toggle="true"
                                            data-show-export="true"
                                            data-show-multi-sort="true"
                                            data-filter-control="true"
                                            data-buttons-class="primary"
                                            data-pagination="true"
                                            data-show-pagination-switch="true"
                                            data-side-pagination="server"
                                            data-page-list="[10, 25, 50, 100, 500, All]"
                                            data-url="{{ url_for('issues.issue_data_index', project_id=project.id) }}",
                                            data-cookie="true"
                                            data-cookie-id-table="IssuesIndex"
                                            data-cookie-storage="localStorage">
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block script %}
    {{ super() }}
    <script nonce="{{ csp_nonce() }}">
        $(function() {
          $('#issues-table').bootstrapTable('destroy').bootstrapTable({
                    filterControl: true,
                    disableUnusedSelectOptions: true,

                    columns: [
                    {
                        field: "id",
                        title: "#",
                        sortable: true,
                        align: 'center',
                        filterControl: 'input',
                    },
                    {
                        field:  "title",
                        title: "{{ Issue.title.info['label'] }}",
                        filterControl: 'input',
                        sortable: true,
                        align: 'center',
                    },
                    {
                        field: 'description',
                        title: '{{ Issue.description.info["label"] }}',
                        filterControl: 'input',
                        sortable: true,
                        align: 'center',
                    },
                    {
                        field: 'status.id-select',
                        title: '{{ Issue.status.info["label"] }}',
                        filterControl: 'select',
                        filterData: 'json:{{ filters["IssueStatus"]|safe }}',
                        sortable: true,
                        align: 'center',
                    },
                    {
                        field: 'cvss',
                        title: '{{ Issue.cvss.info["label"] }}',
                        filterControl: 'input',
                        sortable: true,
                        align: 'center',
                    },
                    {
                        field: 'cve',
                        title: '{{ Issue.cve.info["label"] }}',
                        filterControl: 'input',
                        sortable: true,
                        align: 'center',
                    }
                    ],
                    icons: JSON.parse("{{ bootstrap_table_icons().strip() }}"),
                    onDblClickRow: function(row, element, field) {
                          location = "{{ url_for('issues.issue_show', issue_id='__row_id') }}".replace("__row_id", row.id);
                    },
                    rowStyle: (row, index) => {return { css: { cursor: 'pointer' } }},
                })
        });
      </script>
{% endblock %}